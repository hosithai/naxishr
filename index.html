<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu√©t CCCD & ·ª®ng Tuy·ªÉn</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body { background-color: #f8f9fa; font-family: Arial, sans-serif; }
        .container { max-width: 600px; margin-top: 20px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        #reader { width: 100%; border-radius: 10px; overflow: hidden; margin-bottom: 20px; background: #000; }
        .hidden { display: none; }
        #scanResult { margin-bottom: 15px; font-weight: bold; color: green; min-height: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h3 class="text-center text-primary mb-4">Nh·∫≠p Th√¥ng Tin ·ª®ng Vi√™n</h3>

    <!-- CAMERA -->
    <div id="reader"></div>
    <div class="text-center mb-3">
        <button id="startScanBtn" class="btn btn-warning w-100 fw-bold">üì∑ B·∫≠t Camera Qu√©t CCCD</button>
        <button id="stopScanBtn" class="btn btn-secondary w-100 hidden">üõë D·ª´ng Camera</button>
    </div>
    <p id="scanResult" class="text-center"></p>

    <!-- FORM NH·∫¨P LI·ªÜU -->
    <form id="infoForm">
        <div class="mb-3">
            <label class="form-label">H·ªç v√† T√™n</label>
            <input type="text" class="form-control" id="hoTen" required readonly style="background-color: #e9ecef;">
        </div>
        
        <div class="row">
            <div class="col-6 mb-3">
                <label class="form-label">Ng√†y sinh</label>
                <input type="text" class="form-control" id="ngaySinh" required readonly style="background-color: #e9ecef;">
            </div>
            <div class="col-6 mb-3">
                <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="number" class="form-control" id="sdt" required placeholder="09...">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Qu√™ qu√°n / Th∆∞·ªùng tr√∫</label>
            <input type="text" class="form-control" id="queQuan" required readonly style="background-color: #e9ecef;">
        </div>

        <div class="mb-3">
            <label class="form-label">V·ªã tr√≠ ·ª©ng tuy·ªÉn</label>
            <select class="form-select" id="viTri" required>
                <option value="" selected disabled>Ch·ªçn v·ªã tr√≠...</option>
                <option value="TAG">1. TAG</option>
                <option value="Care">2. Care</option>
                <option value="CS">3. CS</option>
                <option value="Kho">4. Kho</option>
                <option value="TV">5. TV</option>
            </select>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Kinh nghi·ªám</label>
                <input type="text" class="form-control" id="kinhNghiem" placeholder="VD: 1 nƒÉm...">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">M·ª©c l∆∞∆°ng hi·ªán t·∫°i</label>
                <input type="text" class="form-control" id="mucLuong" placeholder="VD: 10tr...">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">L√Ω do chuy·ªÉn vi·ªác</label>
            <input type="text" class="form-control" id="lyDo">
        </div>

        <div class="mb-3">
            <label class="form-label">T√¨nh tr·∫°ng h√¥n nh√¢n</label>
            <select class="form-select" id="honNhan">
                <option value="ƒê·ªôc th√¢n">ƒê·ªôc th√¢n</option>
                <option value="ƒê√£ k·∫øt h√¥n">ƒê√£ k·∫øt h√¥n</option>
            </select>
        </div>

        <button type="submit" id="submitBtn" class="btn btn-primary w-100 py-2 fw-bold">üì§ G·ª≠i Th√¥ng Tin</button>
    </form>
</div>

<!-- CODE X·ª¨ L√ù (JAVASCRIPT) -->
<script>
    // =========================================================================
    // üëáüëáüëá D√ÅN LINK GOOGLE APPS SCRIPT C·ª¶A B·∫†N V√ÄO GI·ªÆA 2 D·∫§U NGO·∫∂C K√âP D∆Ø·ªöI ƒê√ÇY üëáüëáüëá
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwnOJhg-fz8wN3-JVVXODrPPNPJJ-kCpPFtCtr2VqF2SvPlR-S_hsjy9ZVWG9ng6YrOhA/exec"; 
    // V√≠ d·ª• ƒë√∫ng: const GOOGLE_SCRIPT_URL = "https://script.google.com/...";
    // =========================================================================

    let html5QrCode;
    let isScanning = false;

    // 1. H√†m ch·∫°y khi qu√©t th√†nh c√¥ng
    const onScanSuccess = (decodedText, decodedResult) => {
        html5QrCode.stop().then(() => {
            document.getElementById('startScanBtn').classList.remove('hidden');
            document.getElementById('stopScanBtn').classList.add('hidden');
            document.getElementById('scanResult').innerText = "‚úÖ ƒê√£ qu√©t xong!";
            isScanning = false;
        });

        // T√°ch d·ªØ li·ªáu CCCD (NgƒÉn c√°ch b·ªüi d·∫•u |)
        try {
            const parts = decodedText.split('|');
            if (parts.length >= 6) {
                document.getElementById('hoTen').value = parts[2]; 
                
                // Format ng√†y sinh t·ª´ ddMMyyyy -> dd/MM/yyyy
                const d = parts[3];
                document.getElementById('ngaySinh').value = d.substring(0,2) + '/' + d.substring(2,4) + '/' + d.substring(4);
                
                document.getElementById('queQuan').value = parts[5];
            } else {
                alert("M√£ QR kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng CCCD!");
            }
        } catch (e) {
            console.error(e);
            alert("L·ªói ƒë·ªçc d·ªØ li·ªáu: " + e.message);
        }
    };

    // 2. X·ª≠ l√Ω n√∫t B·∫≠t Camera
    document.getElementById('startScanBtn').addEventListener('click', () => {
        // Ki·ªÉm tra th∆∞ vi·ªán
        if (typeof Html5Qrcode === "undefined") {
            alert("L·ªói: M·∫°ng y·∫øu ho·∫∑c ch∆∞a t·∫£i ƒë∆∞·ª£c th∆∞ vi·ªán Camera. H√£y F5 l·∫°i trang!");
            return;
        }

        try {
            if (!html5QrCode) html5QrCode = new Html5Qrcode("reader");
            
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            
            html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess)
            .then(() => {
                document.getElementById('startScanBtn').classList.add('hidden');
                document.getElementById('stopScanBtn').classList.remove('hidden');
                document.getElementById('scanResult').innerText = "ƒêang qu√©t...";
                isScanning = true;
            })
            .catch(err => {
                alert("Kh√¥ng m·ªü ƒë∆∞·ª£c Camera!\nL·ªói: " + err + "\nH√£y th·ª≠ ch·∫°y tr√™n HTTPS ho·∫∑c localhost.");
            });
        } catch (e) {
            alert("L·ªói kh·ªüi t·∫°o: " + e);
        }
    });

    // 3. X·ª≠ l√Ω n√∫t T·∫Øt Camera
    document.getElementById('stopScanBtn').addEventListener('click', () => {
        if(isScanning && html5QrCode) {
            html5QrCode.stop().then(() => {
                document.getElementById('startScanBtn').classList.remove('hidden');
                document.getElementById('stopScanBtn').classList.add('hidden');
                document.getElementById('scanResult').innerText = "";
                isScanning = false;
            });
        }
    });

    // 4. X·ª≠ l√Ω G·ª≠i Form
    document.getElementById('infoForm').addEventListener('submit', function(e) {
        e.preventDefault();

        // Ki·ªÉm tra link script
        if (GOOGLE_SCRIPT_URL.includes("D√ÅN_LINK")) {
            alert("B·∫°n ch∆∞a d√°n link Google Script v√†o code!");
            return;
        }

        const btn = document.getElementById('submitBtn');
        const oldText = btn.innerText;
        btn.innerText = "ƒêang g·ª≠i...";
        btn.disabled = true;

        const data = {
            hoTen: document.getElementById('hoTen').value,
            ngaySinh: document.getElementById('ngaySinh').value,
            queQuan: document.getElementById('queQuan').value,
            sdt: document.getElementById('sdt').value,
            viTri: document.getElementById('viTri').value,
            kinhNghiem: document.getElementById('kinhNghiem').value,
            mucLuong: document.getElementById('mucLuong').value,
            lyDo: document.getElementById('lyDo').value,
            honNhan: document.getElementById('honNhan').value
        };

        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(() => {
            alert("‚úÖ G·ª≠i th√†nh c√¥ng!");
            btn.innerText = oldText;
            btn.disabled = false;
            // X√≥a form n·∫øu mu·ªën: document.getElementById('infoForm').reset();
            window.location.reload(); 
        })
        .catch(error => {
            alert("L·ªói g·ª≠i: " + error);
            btn.innerText = oldText;
            btn.disabled = false;
        });
    });
</script>

</body>
</html>
